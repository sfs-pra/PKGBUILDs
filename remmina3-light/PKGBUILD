# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=remmina-light
_pkgname=remmina
epoch=1
pkgver=1.3.6
pkgver=1.4.32
pkgver=1.4.35
#pkgver=1.2.32
pkgrel=11
pkgdesc="remote desktop client written in GTK+ w/o avahi spice telepathy"
arch=(x86_64)
url="https://www.remmina.org/"
license=('GPL')
#depends=( 'libgcrypt' 'libssh' 'vte3' 'libsodium')
depends=( 'libgcrypt' 'libssh' 'vte3' 'libsecret' 'libsodium' 'libappindicator-gtk3' 'libayatana-appindicator')
replaces=('$_pkgname')
provides=("$_pkgname" )
conflicts=("$_pkgname")

makedepends=('cmake' 'freerdp' 'libvncserver') 
#'spice-gtk' 'spice-protocol' 'telepathy-glib'	     'harfbuzz')
optdepends=('freerdp: RDP plugin'
            'libsecret: Secret plugin'
            'libvncserver: VNC plugin'
            'libxkbfile: NX plugin'
            'nxproxy: NX plugin'
            'spice-gtk: Spice plugin'
            'telepathy-glib: Telepathy plugin'
            'xorg-server-xephyr: XDMCP plugin')
replaces=('remmina-plugins')
provides=('remmina-plugins')
#source=("$_pkgname-$pkgver.tar.gz::https://github.com/FreeRDP/Remmina/archive/v${pkgver/rc/-rc}.tar.gz")
#source=("$pkgname-$pkgver.tar.bz2::https://gitlab.com/Remmina/Remmina/-/archive/v${pkgver/rc/-rc}/Remmina-v${pkgver/rc/-rc}.tar.bz2")
#source=("$pkgname-$pkgver.tar.bz2::https://gitlab.com/Remmina/Remmina/-/archive/v.${pkgver/rc/-rc}/Remmina-v.${pkgver/rc/-rc}.tar.bz2")
source=("$pkgname-$pkgver.tar.bz2::https://gitlab.com/Remmina/Remmina/-/archive/v${pkgver/rc/-rc}/Remmina-v${pkgver/rc/-rc}.tar.bz2")
sha256sums=('SKIP')
#c9a2327d02285cec78ef6eab8154d88d78d2d6a874e17681fcc6cb1aff20c40d')

XXprepare() {
  cd Remmina-v${pkgver/rc/-rc}
  sed -e 's|ssh_threads|ssh|' -i cmake/FindLIBSSH.cmake # Fix build with libssh 0.8
  sed -i 's|include_directories(.)|include_directories(.)\ninclude_directories(/usr/include/harfbuzz)|' CMakeLists.txt
}

build() {
#  cd "$srcdir"/Remmina-v.${pkgver/rc/-rc}/
#  cmake \
  cmake -S Remmina-v${pkgver/rc/-rc} -B build -G Ninja \
    -D CMAKE_BUILD_TYPE=None \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=/usr/lib \
-DWITH_AVAHI=OFF -DWITH_GCRYPT=ON -DWITH_TELEPATHY=OFF -DWITH_SODIM=OFF -DWITH_SPICE=OFF \
    -DWITH_NEWS=OFF -DWITH_APPINDICATOR=ON -DWITH_WEBKIT2GTK=OFF -DWITH_LIBSECRET=ON \
-DHAVE_LIBAPPINDICATOR=ON -DWITH_FREERDP3=ON  -W no-dev
#-DWITH_FREERDP_MASTER=ON

#  make
    cmake --build build
}

package() {
#  cd "$srcdir"/Remmina-v.${pkgver/rc/-rc}/
#  make DESTDIR="$pkgdir" install
  DESTDIR="$pkgdir" cmake --install build
}
